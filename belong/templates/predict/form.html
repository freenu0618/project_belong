{% extends "base.html" %}
{% block content %}
<div class="container my-4">
  <h2>1인 고령가구 고독사 예측</h2>

  <form method="post" action="{{ url_for('predict.index') }}">
    {# CSRF 토큰을 쓰는 경우 (Flask-WTF) #}
    {% if csrf_token is defined %}
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    {% endif %}

    <div class="form-group">
      <label for="gu">자치구</label>
      {# ★ id="gu", name="gu" → views.predict.index 에서 request.form.get("gu") 로 읽음 #}
      <select class="form-control" id="gu" name="gu">
        <option value="">-- 선택 --</option>
        {% for g in regions %}
          <option value="{{ g }}"
                  {% if prediction and prediction.gu == g %}selected{% endif %}>
            {{ g }}
          </option>
        {% endfor %}
      </select>
    </div>

    <div class="form-group mt-2">
      <label for="year">연도</label>
      {# ★ id="year", name="year" → views.predict.index 에서 request.form.get("year") 로 읽음 #}
      <select class="form-control" id="year" name="year">
        <option value="">-- 선택 --</option>
        {% for y in years %}
          <option value="{{ y }}"
                  {% if prediction and prediction.year == y %}selected{% endif %}>
            {{ y }}
          </option>
        {% endfor %}
      </select>
    </div>

    <button type="submit" class="btn btn-primary mt-3">예측하기</button>
  </form>

  {% with messages = get_flashed_messages() %}
    {% if messages %}
      <ul class="mt-3 text-danger">
        {% for msg in messages %}
          <li>{{ msg }}</li>
        {% endfor %}
      </ul>
    {% endif %}
  {% endwith %}

  {% if prediction %}
    <hr>
    <h4>예측 결과</h4>
    <p>
      <strong>{{ prediction.gu }} {{ prediction.year }}년</strong> 의
      예측 고독사 인원수:
      <strong>{{ '%.2f'|format(prediction.predicted_value) }}</strong>
    </p>
    {% if prediction.actual_value is not none %}
      <p>실제 관측값: {{ prediction.actual_value }}</p>
    {% endif %}
    <p class="text-muted">
      (출처: {{ 'DB 캐시' if from_cache else '방금 ML 예측' }})
    </p>
  {% endif %}
</div>
{% endblock %}
